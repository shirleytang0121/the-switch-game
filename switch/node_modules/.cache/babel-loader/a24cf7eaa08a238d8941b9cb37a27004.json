{"ast":null,"code":"/**\r\n * @author       Richard Davey <rich@photonstorm.com>\r\n * @copyright    2019 Photon Storm Ltd.\r\n * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}\r\n */\nvar CanvasPool = require('../display/canvas/CanvasPool');\n/**\r\n * Determines the canvas features of the browser running this Phaser Game instance.\r\n * These values are read-only and populated during the boot sequence of the game.\r\n * They are then referenced by internal game systems and are available for you to access\r\n * via `this.sys.game.device.canvasFeatures` from within any Scene.\r\n * \r\n * @typedef {object} Phaser.Device.CanvasFeatures\r\n * @since 3.0.0\r\n * \r\n * @property {boolean} supportInverseAlpha - Set to true if the browser supports inversed alpha.\r\n * @property {boolean} supportNewBlendModes - Set to true if the browser supports new canvas blend modes.\r\n */\n\n\nvar CanvasFeatures = {\n  supportInverseAlpha: false,\n  supportNewBlendModes: false\n};\n\nfunction checkBlendMode() {\n  var pngHead = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/';\n  var pngEnd = 'AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==';\n  var magenta = new Image();\n\n  magenta.onload = function () {\n    var yellow = new Image();\n\n    yellow.onload = function () {\n      var canvas = CanvasPool.create(yellow, 6, 1);\n      var context = canvas.getContext('2d');\n      context.globalCompositeOperation = 'multiply';\n      context.drawImage(magenta, 0, 0);\n      context.drawImage(yellow, 2, 0);\n\n      if (!context.getImageData(2, 0, 1, 1)) {\n        return false;\n      }\n\n      var data = context.getImageData(2, 0, 1, 1).data;\n      CanvasPool.remove(yellow);\n      CanvasFeatures.supportNewBlendModes = data[0] === 255 && data[1] === 0 && data[2] === 0;\n    };\n\n    yellow.src = pngHead + '/wCKxvRF' + pngEnd;\n  };\n\n  magenta.src = pngHead + 'AP804Oa6' + pngEnd;\n  return false;\n}\n\nfunction checkInverseAlpha() {\n  var canvas = CanvasPool.create(this, 2, 1);\n  var context = canvas.getContext('2d');\n  context.fillStyle = 'rgba(10, 20, 30, 0.5)'; //  Draw a single pixel\n\n  context.fillRect(0, 0, 1, 1); //  Get the color values\n\n  var s1 = context.getImageData(0, 0, 1, 1);\n\n  if (s1 === null) {\n    return false;\n  } //  Plot them to x2\n\n\n  context.putImageData(s1, 1, 0); //  Get those values\n\n  var s2 = context.getImageData(1, 0, 1, 1); //  Compare and return\n\n  return s2.data[0] === s1.data[0] && s2.data[1] === s1.data[1] && s2.data[2] === s1.data[2] && s2.data[3] === s1.data[3];\n}\n\nfunction init() {\n  if (document !== undefined) {\n    CanvasFeatures.supportNewBlendModes = checkBlendMode();\n    CanvasFeatures.supportInverseAlpha = checkInverseAlpha();\n  }\n\n  return CanvasFeatures;\n}\n\nmodule.exports = init();","map":null,"metadata":{},"sourceType":"script"}