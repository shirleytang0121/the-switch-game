{"ast":null,"code":"/**\r\n * @author       Richard Davey <rich@photonstorm.com>\r\n * @copyright    2019 Photon Storm Ltd.\r\n * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}\r\n */\n\n/**\r\n * [description]\r\n *\r\n * @function Phaser.Physics.Impact.SeparateY\r\n * @since 3.0.0\r\n *\r\n * @param {Phaser.Physics.Impact.World} world - [description]\r\n * @param {Phaser.Physics.Impact.Body} top - [description]\r\n * @param {Phaser.Physics.Impact.Body} bottom - [description]\r\n * @param {Phaser.Physics.Impact.Body} [weak] - [description]\r\n */\nvar SeparateY = function SeparateY(world, top, bottom, weak) {\n  var nudge = top.pos.y + top.size.y - bottom.pos.y;\n  var nudgeX;\n  var resTop;\n\n  if (weak) {\n    var strong = top === weak ? bottom : top;\n    weak.vel.y = -weak.vel.y * weak.bounciness + strong.vel.y; // Riding on a platform?\n\n    nudgeX = 0;\n\n    if (weak === top && Math.abs(weak.vel.y - strong.vel.y) < weak.minBounceVelocity) {\n      weak.standing = true;\n      nudgeX = strong.vel.x * world.delta;\n    }\n\n    var resWeak = world.collisionMap.trace(weak.pos.x, weak.pos.y, nudgeX, weak === top ? -nudge : nudge, weak.size.x, weak.size.y);\n    weak.pos.y = resWeak.pos.y;\n    weak.pos.x = resWeak.pos.x;\n  } else if (world.gravity && (bottom.standing || top.vel.y > 0)) {\n    resTop = world.collisionMap.trace(top.pos.x, top.pos.y, 0, -(top.pos.y + top.size.y - bottom.pos.y), top.size.x, top.size.y);\n    top.pos.y = resTop.pos.y;\n\n    if (top.bounciness > 0 && top.vel.y > top.minBounceVelocity) {\n      top.vel.y *= -top.bounciness;\n    } else {\n      top.standing = true;\n      top.vel.y = 0;\n    }\n  } else {\n    var v2 = (top.vel.y - bottom.vel.y) / 2;\n    top.vel.y = -v2;\n    bottom.vel.y = v2;\n    nudgeX = bottom.vel.x * world.delta;\n    resTop = world.collisionMap.trace(top.pos.x, top.pos.y, nudgeX, -nudge / 2, top.size.x, top.size.y);\n    top.pos.y = resTop.pos.y;\n    var resBottom = world.collisionMap.trace(bottom.pos.x, bottom.pos.y, 0, nudge / 2, bottom.size.x, bottom.size.y);\n    bottom.pos.y = resBottom.pos.y;\n  }\n};\n\nmodule.exports = SeparateY;","map":null,"metadata":{},"sourceType":"script"}