{"ast":null,"code":"var AWS = require('./core');\n\nvar inherit = AWS.util.inherit;\n\nvar jmespath = require('jmespath');\n/**\r\n * This class encapsulates the response information\r\n * from a service request operation sent through {AWS.Request}.\r\n * The response object has two main properties for getting information\r\n * back from a request:\r\n *\r\n * ## The `data` property\r\n *\r\n * The `response.data` property contains the serialized object data\r\n * retrieved from the service request. For instance, for an\r\n * Amazon DynamoDB `listTables` method call, the response data might\r\n * look like:\r\n *\r\n * ```\r\n * > resp.data\r\n * { TableNames:\r\n *    [ 'table1', 'table2', ... ] }\r\n * ```\r\n *\r\n * The `data` property can be null if an error occurs (see below).\r\n *\r\n * ## The `error` property\r\n *\r\n * In the event of a service error (or transfer error), the\r\n * `response.error` property will be filled with the given\r\n * error data in the form:\r\n *\r\n * ```\r\n * { code: 'SHORT_UNIQUE_ERROR_CODE',\r\n *   message: 'Some human readable error message' }\r\n * ```\r\n *\r\n * In the case of an error, the `data` property will be `null`.\r\n * Note that if you handle events that can be in a failure state,\r\n * you should always check whether `response.error` is set\r\n * before attempting to access the `response.data` property.\r\n *\r\n * @!attribute data\r\n *   @readonly\r\n *   @!group Data Properties\r\n *   @note Inside of a {AWS.Request~httpData} event, this\r\n *     property contains a single raw packet instead of the\r\n *     full de-serialized service response.\r\n *   @return [Object] the de-serialized response data\r\n *     from the service.\r\n *\r\n * @!attribute error\r\n *   An structure containing information about a service\r\n *   or networking error.\r\n *   @readonly\r\n *   @!group Data Properties\r\n *   @note This attribute is only filled if a service or\r\n *     networking error occurs.\r\n *   @return [Error]\r\n *     * code [String] a unique short code representing the\r\n *       error that was emitted.\r\n *     * message [String] a longer human readable error message\r\n *     * retryable [Boolean] whether the error message is\r\n *       retryable.\r\n *     * statusCode [Numeric] in the case of a request that reached the service,\r\n *       this value contains the response status code.\r\n *     * time [Date] the date time object when the error occurred.\r\n *     * hostname [String] set when a networking error occurs to easily\r\n *       identify the endpoint of the request.\r\n *     * region [String] set when a networking error occurs to easily\r\n *       identify the region of the request.\r\n *\r\n * @!attribute requestId\r\n *   @readonly\r\n *   @!group Data Properties\r\n *   @return [String] the unique request ID associated with the response.\r\n *     Log this value when debugging requests for AWS support.\r\n *\r\n * @!attribute retryCount\r\n *   @readonly\r\n *   @!group Operation Properties\r\n *   @return [Integer] the number of retries that were\r\n *     attempted before the request was completed.\r\n *\r\n * @!attribute redirectCount\r\n *   @readonly\r\n *   @!group Operation Properties\r\n *   @return [Integer] the number of redirects that were\r\n *     followed before the request was completed.\r\n *\r\n * @!attribute httpResponse\r\n *   @readonly\r\n *   @!group HTTP Properties\r\n *   @return [AWS.HttpResponse] the raw HTTP response object\r\n *     containing the response headers and body information\r\n *     from the server.\r\n *\r\n * @see AWS.Request\r\n */\n\n\nAWS.Response = inherit({\n  /**\r\n   * @api private\r\n   */\n  constructor: function Response(request) {\n    this.request = request;\n    this.data = null;\n    this.error = null;\n    this.retryCount = 0;\n    this.redirectCount = 0;\n    this.httpResponse = new AWS.HttpResponse();\n\n    if (request) {\n      this.maxRetries = request.service.numRetries();\n      this.maxRedirects = request.service.config.maxRedirects;\n    }\n  },\n\n  /**\r\n   * Creates a new request for the next page of response data, calling the\r\n   * callback with the page data if a callback is provided.\r\n   *\r\n   * @callback callback function(err, data)\r\n   *   Called when a page of data is returned from the next request.\r\n   *\r\n   *   @param err [Error] an error object, if an error occurred in the request\r\n   *   @param data [Object] the next page of data, or null, if there are no\r\n   *     more pages left.\r\n   * @return [AWS.Request] the request object for the next page of data\r\n   * @return [null] if no callback is provided and there are no pages left\r\n   *   to retrieve.\r\n   * @since v1.4.0\r\n   */\n  nextPage: function nextPage(callback) {\n    var config;\n    var service = this.request.service;\n    var operation = this.request.operation;\n\n    try {\n      config = service.paginationConfig(operation, true);\n    } catch (e) {\n      this.error = e;\n    }\n\n    if (!this.hasNextPage()) {\n      if (callback) callback(this.error, null);else if (this.error) throw this.error;\n      return null;\n    }\n\n    var params = AWS.util.copy(this.request.params);\n\n    if (!this.nextPageTokens) {\n      return callback ? callback(null, null) : null;\n    } else {\n      var inputTokens = config.inputToken;\n      if (typeof inputTokens === 'string') inputTokens = [inputTokens];\n\n      for (var i = 0; i < inputTokens.length; i++) {\n        params[inputTokens[i]] = this.nextPageTokens[i];\n      }\n\n      return service.makeRequest(this.request.operation, params, callback);\n    }\n  },\n\n  /**\r\n   * @return [Boolean] whether more pages of data can be returned by further\r\n   *   requests\r\n   * @since v1.4.0\r\n   */\n  hasNextPage: function hasNextPage() {\n    this.cacheNextPageTokens();\n    if (this.nextPageTokens) return true;\n    if (this.nextPageTokens === undefined) return undefined;else return false;\n  },\n\n  /**\r\n   * @api private\r\n   */\n  cacheNextPageTokens: function cacheNextPageTokens() {\n    if (Object.prototype.hasOwnProperty.call(this, 'nextPageTokens')) return this.nextPageTokens;\n    this.nextPageTokens = undefined;\n    var config = this.request.service.paginationConfig(this.request.operation);\n    if (!config) return this.nextPageTokens;\n    this.nextPageTokens = null;\n\n    if (config.moreResults) {\n      if (!jmespath.search(this.data, config.moreResults)) {\n        return this.nextPageTokens;\n      }\n    }\n\n    var exprs = config.outputToken;\n    if (typeof exprs === 'string') exprs = [exprs];\n    AWS.util.arrayEach.call(this, exprs, function (expr) {\n      var output = jmespath.search(this.data, expr);\n\n      if (output) {\n        this.nextPageTokens = this.nextPageTokens || [];\n        this.nextPageTokens.push(output);\n      }\n    });\n    return this.nextPageTokens;\n  }\n});","map":null,"metadata":{},"sourceType":"script"}