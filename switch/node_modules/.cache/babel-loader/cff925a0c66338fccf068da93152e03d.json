{"ast":null,"code":"/* Copyright 2013 Chris Wilson\r\n\r\n   Licensed under the Apache License, Version 2.0 (the \"License\");\r\n   you may not use this file except in compliance with the License.\r\n   You may obtain a copy of the License at\r\n\r\n       http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n   Unless required by applicable law or agreed to in writing, software\r\n   distributed under the License is distributed on an \"AS IS\" BASIS,\r\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n   See the License for the specific language governing permissions and\r\n   limitations under the License.\r\n*/\n\n/*\r\n\r\nThis monkeypatch library is intended to be included in projects that are\r\nwritten to the proper AudioContext spec (instead of webkitAudioContext),\r\nand that use the new naming and proper bits of the Web Audio API (e.g.\r\nusing BufferSourceNode.start() instead of BufferSourceNode.noteOn()), but may\r\nhave to run on systems that only support the deprecated bits.\r\n\r\nThis library should be harmless to include if the browser supports\r\nunprefixed \"AudioContext\", and/or if it supports the new names.\r\n\r\nThe patches this library handles:\r\nif window.AudioContext is unsupported, it will be aliased to webkitAudioContext().\r\nif AudioBufferSourceNode.start() is unimplemented, it will be routed to noteOn() or\r\nnoteGrainOn(), depending on parameters.\r\n\r\nThe following aliases only take effect if the new names are not already in place:\r\n\r\nAudioBufferSourceNode.stop() is aliased to noteOff()\r\nAudioContext.createGain() is aliased to createGainNode()\r\nAudioContext.createDelay() is aliased to createDelayNode()\r\nAudioContext.createScriptProcessor() is aliased to createJavaScriptNode()\r\nAudioContext.createPeriodicWave() is aliased to createWaveTable()\r\nOscillatorNode.start() is aliased to noteOn()\r\nOscillatorNode.stop() is aliased to noteOff()\r\nOscillatorNode.setPeriodicWave() is aliased to setWaveTable()\r\nAudioParam.setTargetAtTime() is aliased to setTargetValueAtTime()\r\n\r\nThis library does NOT patch the enumerated type changes, as it is\r\nrecommended in the specification that implementations support both integer\r\nand string types for AudioPannerNode.panningModel, AudioPannerNode.distanceModel\r\nBiquadFilterNode.type and OscillatorNode.type.\r\n\r\n*/\n(function () {\n  function fixSetTarget(param) {\n    if (!param) // if NYI, just return\n      return;\n    if (!param.setTargetAtTime) param.setTargetAtTime = param.setTargetValueAtTime;\n  }\n\n  if (window.hasOwnProperty('webkitAudioContext') && !window.hasOwnProperty('AudioContext')) {\n    window.AudioContext = webkitAudioContext;\n    if (!AudioContext.prototype.hasOwnProperty('createGain')) AudioContext.prototype.createGain = AudioContext.prototype.createGainNode;\n    if (!AudioContext.prototype.hasOwnProperty('createDelay')) AudioContext.prototype.createDelay = AudioContext.prototype.createDelayNode;\n    if (!AudioContext.prototype.hasOwnProperty('createScriptProcessor')) AudioContext.prototype.createScriptProcessor = AudioContext.prototype.createJavaScriptNode;\n    if (!AudioContext.prototype.hasOwnProperty('createPeriodicWave')) AudioContext.prototype.createPeriodicWave = AudioContext.prototype.createWaveTable;\n    AudioContext.prototype.internal_createGain = AudioContext.prototype.createGain;\n\n    AudioContext.prototype.createGain = function () {\n      var node = this.internal_createGain();\n      fixSetTarget(node.gain);\n      return node;\n    };\n\n    AudioContext.prototype.internal_createDelay = AudioContext.prototype.createDelay;\n\n    AudioContext.prototype.createDelay = function (maxDelayTime) {\n      var node = maxDelayTime ? this.internal_createDelay(maxDelayTime) : this.internal_createDelay();\n      fixSetTarget(node.delayTime);\n      return node;\n    };\n\n    AudioContext.prototype.internal_createBufferSource = AudioContext.prototype.createBufferSource;\n\n    AudioContext.prototype.createBufferSource = function () {\n      var node = this.internal_createBufferSource();\n\n      if (!node.start) {\n        node.start = function (when, offset, duration) {\n          if (offset || duration) this.noteGrainOn(when || 0, offset, duration);else this.noteOn(when || 0);\n        };\n      } else {\n        node.internal_start = node.start;\n\n        node.start = function (when, offset, duration) {\n          if (typeof duration !== 'undefined') node.internal_start(when || 0, offset, duration);else node.internal_start(when || 0, offset || 0);\n        };\n      }\n\n      if (!node.stop) {\n        node.stop = function (when) {\n          this.noteOff(when || 0);\n        };\n      } else {\n        node.internal_stop = node.stop;\n\n        node.stop = function (when) {\n          node.internal_stop(when || 0);\n        };\n      }\n\n      fixSetTarget(node.playbackRate);\n      return node;\n    };\n\n    AudioContext.prototype.internal_createDynamicsCompressor = AudioContext.prototype.createDynamicsCompressor;\n\n    AudioContext.prototype.createDynamicsCompressor = function () {\n      var node = this.internal_createDynamicsCompressor();\n      fixSetTarget(node.threshold);\n      fixSetTarget(node.knee);\n      fixSetTarget(node.ratio);\n      fixSetTarget(node.reduction);\n      fixSetTarget(node.attack);\n      fixSetTarget(node.release);\n      return node;\n    };\n\n    AudioContext.prototype.internal_createBiquadFilter = AudioContext.prototype.createBiquadFilter;\n\n    AudioContext.prototype.createBiquadFilter = function () {\n      var node = this.internal_createBiquadFilter();\n      fixSetTarget(node.frequency);\n      fixSetTarget(node.detune);\n      fixSetTarget(node.Q);\n      fixSetTarget(node.gain);\n      return node;\n    };\n\n    if (AudioContext.prototype.hasOwnProperty('createOscillator')) {\n      AudioContext.prototype.internal_createOscillator = AudioContext.prototype.createOscillator;\n\n      AudioContext.prototype.createOscillator = function () {\n        var node = this.internal_createOscillator();\n\n        if (!node.start) {\n          node.start = function (when) {\n            this.noteOn(when || 0);\n          };\n        } else {\n          node.internal_start = node.start;\n\n          node.start = function (when) {\n            node.internal_start(when || 0);\n          };\n        }\n\n        if (!node.stop) {\n          node.stop = function (when) {\n            this.noteOff(when || 0);\n          };\n        } else {\n          node.internal_stop = node.stop;\n\n          node.stop = function (when) {\n            node.internal_stop(when || 0);\n          };\n        }\n\n        if (!node.setPeriodicWave) node.setPeriodicWave = node.setWaveTable;\n        fixSetTarget(node.frequency);\n        fixSetTarget(node.detune);\n        return node;\n      };\n    }\n  }\n\n  if (window.hasOwnProperty('webkitOfflineAudioContext') && !window.hasOwnProperty('OfflineAudioContext')) {\n    window.OfflineAudioContext = webkitOfflineAudioContext;\n  }\n})();","map":null,"metadata":{},"sourceType":"script"}